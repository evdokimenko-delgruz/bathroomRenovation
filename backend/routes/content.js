const express = require('express');
const router = express.Router();
const Content = require('../models/Content');

// @route   GET /api/content/:type
// @desc    Получить статический контент по типу (e.g., 'about', 'services', 'reviews', etc.)
// @access  Public
router.get('/:type', async (req, res) => {
    try {
        const contentType = req.params.type;
        const content = await Content.findOne({ type: contentType });

        if (!content) {
            return res.status(404).json({ msg: 'Content not found' });
        }

        res.json(content.data); // Возвращаем только поле 'data'
    } catch (err) {
        console.error(err.message);
        res.status(500).send('Server Error');
    }
});

// @route   POST /api/content/init (для инициализации контента, только один раз)
// @desc    Инициализировать статический контент из ваших .txt файлов
// @access  Private (нужно защитить в реальном приложении)
router.post('/init', async (req, res) => {
    try {
        // Здесь вы могли бы программно загрузить данные из ваших TXT файлов
        // или просто вставить их сюда как JSON-объекты.
        // Это пример, как можно было бы загрузить данные один раз.
        // В реальном приложении это делается через админ-панель или скрипт.

        const initialContent = [
            {
                type: 'slogan',
                data: "Ремонт ванных комнат: качество, которому можно доверять!" // Из Слоган.txt
            },
            {
                type: 'company_info',
                data: { // Из О компании.txt
                    fullText: `Наша компания, "Мастерская Ванных", специализируется на создании стильных и функциональных ванных комнат, которые становятся настоящими оазисами комфорта в вашем доме. С более чем 10-летним опытом в сфере ремонта, мы гордимся высоким качеством наших услуг и индивидуальным подходом к каждому клиенту.
                    Мы предлагаем полный спектр услуг: от разработки дизайна и выбора материалов до профессиональной установки и отделки. Наша команда состоит из квалифицированных специалистов, которые используют только современные технологии и проверенные материалы, чтобы гарантировать долговечность и эстетическую привлекательность каждого проекта.
                    Мы понимаем, что ремонт — это важный шаг, и стремимся сделать его максимально комфортным и беззаботным для вас. С нами вы можете быть уверены, что ваша ванная комната станет не только красивой, но и удобной для повседневного использования.
                    Доверьте нам создание вашего идеального пространства, и мы превратим ваши мечты в реальность!`
                }
            },
            {
                type: 'team_info',
                data: { // Из Информация о команде.txt
                    mainIntro: `В "Мастерская Ванных" мы гордимся нашей командой профессионалов, которые делают возможным создание идеальных ванных комнат. Каждый из нас — это высококвалифицированный специалист, обладающий богатым опытом и страстью к своему делу. Мы работаем вместе, чтобы обеспечить нашим клиентам наилучший результат и превратить их мечты в реальность.`,
                    specialists: [
                        { role: "Дизайнеры интерьеров", description: "Наши дизайнеры обладают креативным мышлением и глубокими знаниями в области современных тенденций. Они помогут вам создать уникальный и функциональный дизайн вашей ванной комнаты, учитывая ваши предпочтения и стиль жизни." },
                        { role: "Сантехники", description: "Команда опытных сантехников обеспечивает качественную установку и обслуживание сантехнического оборудования. Мы гарантируем, что все работы будут выполнены в соответствии с высокими стандартами безопасности и качества." },
                        { role: "Отделочники", description: "Наши мастера по отделке имеют богатый опыт в укладке плитки, покраске и других отделочных работах. Они уделяют внимание каждой детали, чтобы ваша ванная комната выглядела безупречно." },
                        { role: "Проектировщики", description: "Проектировщики нашей команды занимаются разработкой технической документации и планов, что позволяет нам эффективно организовать процесс ремонта и избежать возможных проблем." },
                        { role: "Менеджеры проектов", description: "Наши менеджеры проектов координируют все этапы работы, обеспечивая соблюдение сроков и бюджета. Они всегда на связи и готовы ответить на ваши вопросы, чтобы вы чувствовали себя уверенно на каждом этапе ремонта." },
                    ],
                    philosophy: `Мы верим, что успешный проект — это результат командной работы и взаимопонимания. Каждый член нашей команды вносит свой вклад в общий успех, и мы стремимся к тому, чтобы каждый клиент остался доволен результатом. Наша цель — не просто выполнить ремонт, а создать пространство, в котором вы будете чувствовать себя комфортно и счастливо.
                    Мы постоянно обучаемся и развиваемся, чтобы быть в курсе последних тенденций и технологий в области ремонта. С нами вы можете быть уверены, что ваша ванная комната будет не только красивой, но и функциональной, отвечающей всем вашим потребностям.`,
                }
            },
            {
                type: 'advantages',
                data: [ // Из Преимущества.txt
                    "Профессионализм и опыт: Наша команда состоит из высококвалифицированных специалистов с более чем 10-летним опытом в сфере ремонта ванных комнат.",
                    "Индивидуальный подход: Мы учитываем все пожелания и требования клиентов, предлагая уникальные решения, которые соответствуют вашему стилю и бюджету.",
                    "Качество материалов: Мы работаем только с проверенными и надежными поставщиками, что гарантирует долговечность и высокое качество используемых материалов.",
                    "Комплексные услуги: Предлагаем полный спектр услуг: от проектирования и выбора материалов до выполнения всех этапов ремонта, включая сантехнические и отделочные работы.",
                    "Современные технологии: Используем новейшие технологии и методы, что позволяет нам достигать высоких стандартов качества и эффективности.",
                    "Прозрачность цен: Мы предоставляем четкие сметы и не скрываем дополнительные расходы, чтобы вы всегда знали, за что платите.",
                    "Гарантия на работу: Мы уверены в качестве своих услуг и предоставляем гарантию на выполненные работы, что обеспечивает дополнительное спокойствие нашим клиентам.",
                    "Соблюдение сроков: Мы ценим ваше время и гарантируем выполнение работ в оговоренные сроки без задержек.",
                    "Отличное послепродажное обслуживание: Мы всегда готовы ответить на ваши вопросы и помочь с любыми проблемами даже после завершения проекта.",
                ]
            },
            {
                type: 'services',
                data: [ // Из Услуги.txt
                    {
                        title: "Демонтаж",
                        description: "Удаление старых отделочных материалов, сантехники и мебели. Подготовка помещения к ремонту. Примеры работ: Снятие старой плитки, демонтаж ванны, удаление старых труб.",
                        price: "от 50 до 100 рублей за квадратный метр (в зависимости от сложности)."
                    },
                    {
                        title: "Проектирование и дизайн",
                        description: "Разработка индивидуального дизайна ванной комнаты с учетом ваших пожеланий и потребностей. Примеры работ: Создание 3D-визуализаций, подбор цветовой гаммы и материалов.",
                        price: "от 3000 до 10000 рублей (в зависимости от сложности проекта)."
                    },
                    {
                        title: "Укладка плитки",
                        description: "Профессиональная укладка керамической, керамогранитной и мозаичной плитки на пол и стены. Примеры работ: Укладка плитки на пол, создание плиточных панно на стенах.",
                        price: "от 800 до 1500 рублей за квадратный метр (в зависимости от типа плитки и сложности укладки)."
                    },
                    {
                        title: "Сантехнические работы",
                        description: "Установка и замена сантехники, прокладка трубопроводов и канализации. Примеры работ: Установка унитаза, раковины, душевой кабины, замена старых труб.",
                        price: "от 2000 до 5000 рублей за установку (в зависимости от типа сантехники)."
                    },
                    {
                        title: "Электромонтажные работы",
                        description: "Установка и замена электропроводки, монтаж освещения и розеток. Примеры работ: Установка и замена электропроводки, монтаж освещения и розеток.",
                        price: "от 1000 до 3000 рублей за точку подключения (в зависимости от сложности)."
                    },
                    {
                        title: "Отделочные работы",
                        description: "Покраска и оклейка стен, установка натяжных и подвесных потолков. Примеры работ: Покраска стен, установка натяжного потолка.",
                        price: "от 200 до 500 рублей за квадратный метр (в зависимости от типа отделки)."
                    },
                    {
                        title: "Установка мебели и аксессуаров",
                        description: "Монтаж встроенной и модульной мебели для ванных комнат, установка зеркал и полок. Примеры работ: Установка шкафчиков, зеркал, полок.",
                        price: "от 1000 до 3000 рублей за единицу (в зависимости от сложности установки)."
                    },
                    {
                        title: "Гидроизоляция",
                        description: "Проведение работ по гидроизоляции стен и пола для предотвращения протечек. Примеры работ: Нанесение гидроизоляционных материалов на пол и стены.",
                        price: "от 300 до 600 рублей за квадратный метр."
                    },
                    {
                        title: "Установка систем отопления",
                        description: "Монтаж теплых полов и радиаторов для создания комфортной температуры в ванной. Примеры работ: Установка электрического теплого пола, монтаж радиаторов.",
                        price: "от 1500 до 3000 рублей за квадратный метр (для теплого пола)."
                    },
                    {
                        title: "Консультации и подбор материалов",
                        description: "Помощь в выборе качественных материалов и сантехники, консультации по вопросам дизайна. Примеры работ: Подбор плитки, сантехники, мебели.",
                        price: "Бесплатно при заказе других услуг."
                    },
                ]
            },
            {
                type: 'reviews',
                data: [ // Из Отзывы.txt
                    {
                        author: "Ирина П.",
                        text: "Я очень довольна работой команды 'Мастерская Ванных'! Они полностью преобразили мою ванную комнату, и теперь это мое любимое место в доме. Дизайнер предложил отличные идеи, а мастера выполнили все работы быстро и качественно. Особенно понравилось, что они всегда были на связи и отвечали на все мои вопросы. Рекомендую всем!"
                    },
                    {
                        author: "Сергей А.",
                        text: "Обратился в 'Мастерская Ванных' по рекомендации друга, и не пожалел! Ремонт прошел без задержек, а качество работы превзошло все ожидания. Сантехники сделали свою работу на высшем уровне, и теперь у меня нет никаких проблем с водопроводом. Спасибо за профессионализм и внимательное отношение к клиентам!"
                    },
                    {
                        author: "Карина О.",
                        text: "Я долго искала компанию, которая могла бы сделать ремонт в ванной комнате, и наконец нашла 'Ремонт Ванных'. С самого начала меня поразило, как внимательно они отнеслись к моим пожеланиям. Результат превзошел все ожидания! Ванная комната стала не только красивой, но и очень удобной. Огромное спасибо всей команде за отличную работу!"
                    }
                ]
            },
            {
                type: 'contacts',
                data: { // Из Контакты.txt
                    address: "г. Москва, ул. Молодежная, 11, к. 15",
                    phone: "(912) 00-55-000",
                    email: "mastervann@mail.ru"
                }
            },
            {
                type: 'tips',
                data: [ // Из Советы.txt
                    {
                        title: "Планируйте пространство заранее",
                        description: "Перед началом ремонта важно тщательно спланировать, как будет выглядеть ваша ванная комната. Определите, какие элементы вам необходимы (унитаз, раковина, душ или ванна) и как они будут расположены. Используйте 3D-визуализации или простые эскизы, чтобы увидеть, как будет выглядеть конечный результат. Убедитесь, что между элементами достаточно пространства для комфортного использования. Это поможет избежать неудобств в будущем и сделает вашу ванную комнату более функциональной."
                    },
                    {
                        title: "Выбирайте качественные материалы",
                        description: "При ремонте ванной комнаты важно использовать влагостойкие и долговечные материалы. Плитка, сантехника и отделочные материалы должны быть устойчивыми к влаге и перепадам температуры. Обратите внимание на качество и репутацию производителей. Хотя качественные материалы могут стоить дороже, они обеспечат долговечность и снизят вероятность необходимости ремонта в будущем."
                    },
                    {
                        title: "Не забывайте о вентиляции",
                        description: "Правильная вентиляция — ключевой аспект в ванной комнате, который часто игнорируется. Убедитесь, что в вашей ванной комнате есть качественная вентиляционная система, чтобы предотвратить образование плесени и грибка. Если возможно, установите вытяжной вентилятор, который будет работать автоматически при включении света. Это поможет поддерживать свежесть и чистоту в помещении, а также продлит срок службы отделочных материалов."
                    }
                ]
            },
            {
                type: 'articles',
                data: [ // Из Статьи.txt (частично)
                    {
                        title: "Топ-5 трендов в дизайне ванных комнат на 2024 год",
                        intro: "Ванная комната — это не только функциональное пространство, но и место, где мы можем расслабиться и насладиться моментом. В этой статье мы рассмотрим самые актуальные тренды в дизайне ванных комнат на 2024 год, которые помогут вам создать стильное и комфортное пространство.",
                        sections: [
                            { heading: "Минимализм", content: "Минималистичный дизайн продолжает оставаться в моде. Чистые линии, простые формы и нейтральные цвета создают ощущение простора и спокойствия. Используйте встроенные шкафы и скрытые системы хранения, чтобы избежать беспорядка." },
                            { heading: "Натуральные материалы", content: "Дерево, камень и другие натуральные материалы становятся все более популярными. Они добавляют тепла и уюта в ванную комнату. Рассмотрите возможность использования деревянных полок или каменной плитки для создания уникального стиля." },
                            { heading: "Умные технологии", content: "Современные технологии проникают в каждую сферу нашей жизни, и ванные комнаты не исключение. Умные зеркала с подсветкой, термостаты для душа и системы управления освещением делают использование ванной комнаты более удобным и комфортным." },
                            { heading: "Яркие акценты", content: "Не бойтесь добавлять яркие акценты в интерьер. Это могут быть цветные плитки, яркие полотенца или оригинальные аксессуары. Они помогут сделать пространство более живым и интересным." },
                            { heading: "Экологичность", content: "С каждым годом все больше людей обращают внимание на экологические аспекты. Используйте водосберегающие сантехнические приборы." }
                        ]
                    },
                    {
                        title: "Как выбрать идеальную плитку для ванной комнаты",
                        intro: "Плитка — один из самых популярных материалов для отделки ванных комнат. Но как выбрать идеальную плитку, которая будет сочетать в себе красоту, долговечность и функциональность? В этой статье мы поделимся полезными советами.",
                        sections: [
                            { heading: "Учитывайте влагостойкость", content: "Ванная комната — это помещение с высокой влажностью, поэтому выбирайте плитку, которая устойчива к влаге. Керамическая и керамогранитная плитка — отличные варианты, так как они не впитывают воду и легко чистятся." },
                            { heading: "Размер плитки", content: "Размер плитки может существенно повлиять на восприятие пространства. Большие плитки визуально увеличивают пространство, в то время как маленькие плитки могут добавить текстуры и интереса. Подумайте о том, какой эффект вы хотите достичь." },
                            { heading: "Цвет и текстура", content: "Выбор цвета и текстуры плитки зависит от вашего стиля и предпочтений. Нейтральные цвета создают спокойную атмосферу, в то время как яркие и насыщенные оттенки могут добавить энергии. Текстурированная плитка может помочь избежать скольжения на мокром полу." },
                            { heading: "Укладка плитки", content: "Правильная укладка плитки — это залог долговечности и эстетики. Если вы не уверены в своих силах, лучше обратиться к профессионалам. Они помогут избежать распространенных ошибок и обеспечат качественный результат." }
                        ]
                    }
                ]
            },
            {
                type: 'gallery_images',
                data: [ // Только названия файлов, путь будет известен фронтенду или через CDN
                    'gallery-1.jpg', 'gallery-2.jpg', 'gallery-3.jpg', 'gallery-4.jpg',
                    'gallery-5.jpg', 'gallery-6.jpg', 'gallery-7.jpg', 'gallery-8.jpg',
                    'gallery-9.jpg', 'gallery-10.jpg', 'gallery-11.jpg', 'gallery-12.jpg',
                    'gallery-13.jpg', 'gallery-14.jpg', 'gallery-15.jpg', 'gallery-16.jpg',
                    'dushinurgaga-vannitoa-remont-1024x683.jpg',
                    'kapitalnii-remont-vannoi-komnati.jpg',
                    'portfolio-1.jpg',
                    '658d67396ca4f.jpg',
                    'kak-ehkonomno-obnovit-vannuyu-komnatu.jpg',
                    'remont-vannoy2-min.jpg',
                    'sanuze_remont_2_21.jpg',
                    'dizayn-interyera-4-komnantoj-kvartiry-144-kv-m-foto-14-3914.jpg'
                ]
            }
        ];

        // Удаляем существующий контент и вставляем новый
        await Content.deleteMany({});
        await Content.insertMany(initialContent);

        res.status(201).json({ msg: 'Content initialized successfully', count: initialContent.length });
    } catch (err) {
        console.error(err.message);
        res.status(500).send('Server Error');
    }
});


// @route   PUT /api/content/:type
// @desc    Обновить статический контент
// @access  Private (требуется аутентификация)
router.put('/:type', async (req, res) => {
    try {
        const contentType = req.params.type;
        const { data } = req.body;

        let content = await Content.findOne({ type: contentType });

        if (!content) {
            return res.status(404).json({ msg: 'Content not found' });
        }

        content.data = data;
        content.lastUpdated = Date.now();
        await content.save();

        res.json(content.data);
    } catch (err) {
        console.error(err.message);
        res.status(500).send('Server Error');
    }
});

module.exports = router;